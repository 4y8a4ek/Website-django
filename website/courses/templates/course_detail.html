{% load custom_filters %}

<h2>{{ course.title }}</h2>
<p>{{ course.description }}</p>
<p><strong>–ü—Ä–æ–≥—Ä–µ—Å—Å:</strong> {{ progress }}%</p>

<hr>

<h3>üìö –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ</h3>
<ul>
    {% for section in sections %}
        <li>
            {% if section_locked|index:forloop.counter0 %}
                üîí {{ section.title }}
            {% else %}
                <strong>–°–µ–∫—Ü–∏—è {{ forloop.counter }}: {{ section.title }}</strong>
                <ul>
                    {% for block in section.content %}
                        {% if forloop.counter0 in completed|get_item:forloop.parentloop.counter0|stringformat:"s" %}
                            <li style="color: green;">‚úî {{ block.title|default:"–í–æ–ø—Ä–æ—Å" }}</li>
                        {% elif forloop.counter0 == current_block_index and forloop.parentloop.counter0 == current_section_index %}
                            <li><strong>‚û° {{ block.title|default:"–¢–µ–∫—É—â–∏–π –±–ª–æ–∫" }}</strong></li>
                        {% else %}
                            <li>{{ block.title|default:"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è" }}</li>
                        {% endif %}
                    {% endfor %}
                </ul>
            {% endif %}
        </li>
    {% endfor %}
</ul>

<hr>

{% if current_content.type == 'theory' %}
    <h3>{{ current_content.title }}</h3>
    <p>{{ current_content.text }}</p>
{% endif %}

{% if current_content.type == 'test' %}
    <h3>{{ current_content.question }}</h3>

    {% if completed|get_item:current_block %}
        <p style="color: green;">‚úÖ –í–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç!</p>
    {% elif incorrect|get_item:current_block %}
        <p style="color: red;">‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</p>
    {% endif %}

    {% if not completed|get_item:current_block %}
        <form method="post">
            {% csrf_token %}
            {% if current_content.test_type == 'single_choice' %}
                {% for opt in current_content.options %}
                    <label>
                        <input type="radio" name="answer" value="{{ forloop.counter0 }}"> {{ opt }}
                    </label><br>
                {% endfor %}
            {% elif current_content.test_type == 'multiple_choice' %}
                {% for opt in current_content.options %}
                    <label>
                        <input type="checkbox" name="answer" value="{{ forloop.counter0 }}"> {{ opt }}
                    </label><br>
                {% endfor %}
            {% elif current_content.test_type == 'ordering' %}
                <p>–í–≤–µ–¥–∏—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2,0,1)</p>
                <ul>
                    {% for opt in current_content.shuffled_options %}
                        <li>{{ forloop.counter0 }}: {{ opt }}</li>
                    {% endfor %}
                </ul>
                <input type="text" name="answer">
            {% endif %}

            <button type="submit" name="submit_answer">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
        </form>
    {% endif %}
{% endif %}


<form method="post" style="margin-top: 20px;">
    {% csrf_token %}
    {% if can_go_back %}
        <button type="submit" name="go_back">‚Üê –ù–∞–∑–∞–¥</button>
    {% endif %}
    {% if can_go_forward %}
        <button type="submit" name="go_forward">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
    {% endif %}
</form>
