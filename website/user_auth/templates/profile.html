{% load static %}
{% get_media_prefix as media_url %}
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ—Ñ–∏–ª—å</title>
    <link rel="stylesheet" href="{% static 'css/profile.css' %}?v={{ timestamp }}">
    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }

        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('theme');
            if (saved) {
                document.documentElement.setAttribute('data-theme', saved);
            }
        });

        function showFormConfirmation(formId) {
            const modal = document.getElementById(formId + '-modal');
            modal.classList.add('show');
        }

        function hideConfirmation() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => modal.classList.remove('show'));
        }
    </script>
</head>
<body>

<div class="navbar">
    <a href="/" class="logo-link"><img src="{% static 'images/logo.png' %}" alt="–õ–æ–≥–æ—Ç–∏–ø" class="logo-img"></a>
    <a href="/" class="home-btn">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="/courses" class="home-btn">–ö—É—Ä—Å—ã</a>
    <a href="/logout" class="home-btn">–í—ã–π—Ç–∏</a>
    <button class="theme-btn" onclick="toggleTheme()">üåì</button>
</div>

<div class="container">
    <div class="profile-container">
        <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
        <img src="{{ profile.photo.url }}" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è" width="200" height="200" id="profile-photo">
        <p><strong>–ò–º—è:</strong> {{ profile.user.name }}</p>
        <p><strong>üí°EXP:</strong> {{ profile.exp }}</p>
        <p><strong>‚≠êStars:</strong> {{ profile.stars }}</p>
    </div>

    {% if completed_courses %}
    <div class="profile-container">
        <h3>–ü—Ä–æ–π–¥–µ–Ω–Ω—ã–µ –∫—É—Ä—Å—ã</h3>
        <div class="courses-progress">
            {% for course in completed_courses %}
                <div class="course-card">
                    <img src="{{ media_url }}course_photos/{{ course.photo }}" alt="{{ course.title }}">
                    <h4>{{ course.title }}</h4>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if active_courses %}
    <div class="profile-container">
        <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫—É—Ä—Å–∞–º</h3>
        <div class="courses-progress">
            {% for course in active_courses %}
                <div class="course-card">
                    <img src="{{ media_url }}course_photos/{{ course.photo }}" alt="{{ course.title }}">
                    <h4>{{ course.title }}</h4>
                    <div class="progress-bar">
                        <div class="progress-bar-inner" style="width: {{ course.completed_percent }}%;"></div>
                    </div>
                    <p>–ü—Ä–æ–≥—Ä–µ—Å—Å: {{ course.completed_percent }}%</p>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="profile-container">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–º</h3>

        <div class="form-buttons">
            <button class="home-btn" onclick="showFormConfirmation('photo-form')">üì∑ –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
            <button class="home-btn" onclick="showFormConfirmation('name-form')">‚úèÔ∏è –°–º–µ–Ω–∏—Ç—å –∏–º—è</button>
            <button class="home-btn" onclick="showFormConfirmation('email-form')">üìß –°–º–µ–Ω–∏—Ç—å email</button>
            <button class="home-btn" onclick="showFormConfirmation('password-form')">üîí –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
            <button class="home-btn" onclick="showFormConfirmation('delete-profile-form')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–æ—Ä–º—ã -->
        <div class="modal" id="photo-form-modal">
            <div class="modal-content">
                <h4>–û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ç–æ</h4>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ photo_form.photo }}
                    <button type="submit" name="update_photo" class="home-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ç–æ</button>
                    <button type="button" onclick="hideConfirmation()" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                </form>
            </div>
        </div>

        <div class="modal" id="name-form-modal">
            <div class="modal-content">
                <h4>–°–º–µ–Ω–∏—Ç—å –∏–º—è</h4>
                <form method="post">
                    {% csrf_token %}
                    <input type="name" name="name" placeholder="–ù–æ–≤–æ–µ –∏–º—è" required>
                    <button type="submit" name="change_name" class="home-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" onclick="hideConfirmation()" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                </form>
            </div>
        </div>

        <div class="modal" id="email-form-modal">
            <div class="modal-content">
                <h4>–°–º–µ–Ω–∏—Ç—å email</h4>
                <form method="post">
                    {% csrf_token %}
                    <input type="email" name="email" placeholder="–ù–æ–≤—ã–π email" required>
                    <button type="submit" name="change_email" class="home-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" onclick="hideConfirmation()" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                </form>
            </div>
        </div>

        <div class="modal" id="password-form-modal">
            <div class="modal-content">
                <h4>–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h4>
                <form method="post">
                    {% csrf_token %}
                    <label for="current_password">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="current_password" name="current_password" required>
                    
                    <label for="new_password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="new_password" name="new_password" required>
        
                    <button type="submit" name="change_password" class="home-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" onclick="hideConfirmation()" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                </form>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="modal" id="delete-profile-form-modal">
            <div class="modal-content">
                <h4>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å?</h4>
                <form method="post">
                    {% csrf_token %}
                    <button type="submit" name="delete_profile" class="confirm-btn">–£–¥–∞–ª–∏—Ç—å</button>
                    <button type="button" onclick="hideConfirmation()" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                </form>
            </div>
        </div>
    </div>
</div>

<footer class="footer">
    <p>¬© 2025 Your Website. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
</footer>

</body>
</html>
