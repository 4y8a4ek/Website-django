{% load static %}
{% get_media_prefix as media_url %}
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å</title>
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }

        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('theme');
            if (saved) {
                document.documentElement.setAttribute('data-theme', saved);
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–æ—Ç–æ
        function previewPhoto(event) {
            const photo = document.getElementById('profile-photo');
            const file = event.target.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photo.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        // –û—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è
        function showConfirmation() {
            document.getElementById('confirmation-modal').style.display = 'flex';
        }

        // –ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        function hideConfirmation() {
            document.getElementById('confirmation-modal').style.display = 'none';
        }

        // –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        function deleteProfile() {
            fetch('/delete-profile/', { method: 'POST', headers: { 'X-CSRFToken': '{{ csrf_token }}' } })
                .then(response => {
                    if (response.ok) {
                        window.location.href = '/'; // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è');
                    }
                });
        }
    </script>
</head>
<body>

<div class="navbar">
    <a href="/" class="logo-link">
        <img src="{% static 'images/logo.png' %}" alt="–õ–æ–≥–æ—Ç–∏–ø" class="logo-img">
    </a>
    <a href="/" class="home-btn">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="/courses" class="home-btn">–ö—É—Ä—Å—ã</a>
    <a href="/logout" class="home-btn">–í—ã–π—Ç–∏</a>
    <button class="theme-btn" onclick="toggleTheme()">üåì</button>
</div>

<div class="container">
    <div class="profile-container">
        <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
        
        <!-- –§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è -->
        <img src="{{ profile.photo.url }}" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è" width="200" height="200" id="profile-photo">

        <p><strong>–ò–º—è:</strong> {{ profile.user.name }}</p>
        <p><strong>üí°EXP:</strong> {{ profile.exp }}</p>
        <p><strong>‚≠êStars:</strong> {{ profile.stars }}</p>

        <!-- –§–æ—Ä–º–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ -->
        <input type="file" id="photo-upload" name="photo" accept="image/*" style="display:none;" onchange="previewPhoto(event)">
        <button class="home-btn" type="button" onclick="document.getElementById('photo-upload').click()">–û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
        
        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
        <button id="delete-profile-btn" class="home-btn" onclick="showConfirmation()">–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
        <div id="confirmation-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å?</h3>
                <form method="POST" action="{% url 'profile_app:delete_profile' %}">
                    {% csrf_token %}
                    <button type="submit" class="confirm-btn">–î–∞, —É–¥–∞–ª–∏—Ç—å</button>
                    <button type="button" class="cancel-btn" onclick="hideConfirmation()">–û—Ç–º–µ–Ω–∞</button>
                </form>
            </div>
        </div>
    </div>

    {% if course_progress_list %}
    <div class="profile-container">
        <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫—É—Ä—Å–∞–º</h3>
        <div class="courses-progress">
            {% for course in course_progress_list %}
                <div class="course-card">
                    <img src="{{ media_url }}course_photos/{{ course.photo }}" alt="{{ course.title }}">
                    <h4>{{ course.title }}</h4>
                    <div class="progress-bar">
                        <div class="progress-bar-inner" style="width: {{ course.completed_percent }}%;"></div>
                    </div>
                    <p>–ü—Ä–æ–≥—Ä–µ—Å—Å: {{ course.completed_percent }}%</p>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<footer class="footer">
    <p>¬© 2025 Your Website. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    <p><a href="#">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a> | <a href="#">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a></p>
</footer>

</body>
</html>
